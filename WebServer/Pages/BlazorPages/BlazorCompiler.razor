@page "/compiler"
<div>
    <span>Text</span><br/>
    <input type = "Text" width="100%" height="400px" @bind-value="Text"> <br/>
    <br/>
    <div>
        @if(Success)
        {
            @if(!diagnostics.Any())
            {
                <h6>@result.Value</h6>
            }
            else
            {
                @foreach(var diagnostic in diagnostics)
                {
                    @if(diagnostic!=null)
                    {
                        DiagnosticProccess(diagnostic);
                        <h2 style="color: brown;">@diagnostic</h2><br/>
                        <span style="font-size: 28px;">@prefix <span style="color: brown;">@error</span> @subfix</span>
                    }
                }
            }
        }
    </div>
    <input type="button" value="Compiler" class="btn btn-success" @onclick="OnClickBtnMethod" />
</div>
@code
{
    [Parameter]
    public bool Success{get;set;}
    [Parameter]
    public string Text {get;set;}
    public Dictionary<VariableSymbol,object> variables = new Dictionary<VariableSymbol,object>();
    public SyntaxTree syntaxTree {get;set;}
    public Compilation compilation {get;set;}
    [Parameter]
    public EvaluationResult result{get;set;}
    [Parameter]
    public IEnumerable<Diagnostic> diagnostics{get;set;}
    [Parameter]
    public string prefix{get;set;}
    [Parameter]
    public string error{get;set;}
    [Parameter]
    public string subfix{get;set;}
    public void OnClickBtnMethod()
    {
        syntaxTree =  SyntaxTree.Parse(Text);
        compilation = new Compilation(syntaxTree);
        result = compilation.Evaluate(variables);
        diagnostics = result.Diagnostics;
        if(!Success)
            Success = true;
        else
            Success = false;
    }
    protected override void OnInitialized()
    {
        base.OnInitialized();
        Success = false;
    }
    public void DiagnosticProccess(Diagnostic diagnostic)
    {
        prefix = Text.Substring(0,diagnostic.Span.Start);
        error = Text.Substring(diagnostic.Span.Start, diagnostic.Span.Length);
        subfix = Text.Substring(diagnostic.Span.End);
    }
}